{"version":3,"sources":["grayscale-polyfill.js"],"names":["window","NodeList","prototype","forEach","Array","Element","remove","parentNode","removeChild","Object","getOwnPropertyDescriptor","HTMLElement","classList","defineProperty","isSupport","testImg","Image","style","filter","createSVGFilterGrayScale","filterId","filterValue","namespaceURI","svg","document","createElementNS","position","top","left","height","width","defs","appendChild","setAttribute","feColorMatrix","body","createSVGElem","id","cssText","src","backgroundColor","container","createElement","add","svgBackground","shapeBackground","el","padding","image","setAttributeNS","checkFilterExists","getElementById","replaceElem","getAttribute","getComputedStyle","dataset","match","insertBefore","applyFilter","elements","querySelectorAll","addEventListener"],"mappings":"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","sourcesContent":["// Запускается в браузерах который не поддерживают свойство filter.\n// Полифил применяетс к тегам img[data-filter='grayscale(50%)']\n// по значению grayscale(50%) создается фильтр #filter-grayscale-50, который\n// нужно использовать с CSS `filter: url('#filter-grayscale-50')`\n// Можно создать несколько фильтров задав разное значение в элементах.\n\n// Удаляет элемент и создает обертку c контейнера (div) и 3-ех SVG:\n// 1) фон с приминением фильтра - необходимо создавать, что бы его расстянуть\n// на весь родительский блок, если в нем заданы отступы padding для изображения\n// 2) изображения для фильтра\n// 3) изображение без фильтра - нужно что бы создать анимацию для фильтра. В IE 11 не\n// filter: url() не работает анимация, поэтому используем прозрачность (opacity)\n//\n// В IE 11 и EDGE - CSS нужно прописывать стили, не на сам SVG, а на его элементы\n//\n//    .svg-filter-background *,\n//    .svg-filter * {\n//       filter: url('#filter-grayscale-100');\n//    }\n//\n//\n//\n\n// Нужно перекомилировать через Babel\n// Неообходимые полифилы для IE-11\n// Element.classList\n// NodeList.forEach\n// Element.remove\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n  NodeList.prototype.forEach = Array.prototype.forEach;\n}\n\nif (!('remove' in Element.prototype)) {\n  Element.prototype.remove = function() {\n    if (this.parentNode) this.parentNode.removeChild(this);\n  };\n}\n\nif (!Object.getOwnPropertyDescriptor(Element.prototype, 'classList') && HTMLElement) {\n  const classList = Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'classList');\n  classList && Object.defineProperty(Element.prototype, 'classList', classList);\n}\n\n(() => {\n  // В IE 11 fiter значение не применяется, но само свойство присуствует\n  const isSupport = (() => {\n    const testImg = new Image();\n    testImg.style.filter = 'grayscale(100%)';\n    return !testImg.style.filter;\n  })();\n\n  // Создаем фильтр\n  const createSVGFilterGrayScale = ({ filterId, filterValue }) => {\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(namespaceURI, 'svg');\n\n    svg.style.position = 'absolute';\n    svg.style.top = '0';\n    svg.style.left = '0';\n    svg.style.height = '0';\n    svg.style.width = '0';\n\n    const defs = svg.appendChild(document.createElementNS(namespaceURI, 'defs'));\n\n    const filter = defs.appendChild(document.createElementNS(namespaceURI, 'filter'));\n    filter.setAttribute('id', filterId);\n    const feColorMatrix = filter.appendChild(\n      document.createElementNS(namespaceURI, 'feColorMatrix'),\n    );\n    feColorMatrix.setAttribute('id', 'filter-grayscale-elem');\n    feColorMatrix.setAttribute('type', 'saturate');\n    feColorMatrix.setAttribute('values', `${1 - filterValue / 100}`);\n\n    document.body.appendChild(svg);\n  };\n\n  const createSVGElem = ({ id, cssText, classList, src, backgroundColor }) => {\n    const container = document.createElement('div');\n    id && container.setAttribute('id', id);\n    classList && container.classList.add(classList);\n    cssText && (container.style.cssText = cssText);\n    container.style.position === 'absolute' && (container.style.position = 'relative');\n\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n\n    // Создаем SVG для фона c наложеным фильтром\n    // потому что у IE11 и EDGE не\n    // работает filter если его применить в SVG\n    const svgBackground = container.appendChild(document.createElementNS(namespaceURI, 'svg'));\n    svgBackground.classList.add('svg-filter-background');\n    svgBackground.setAttribute('width', '100%');\n    svgBackground.setAttribute('height', '100%');\n    svgBackground.style.position = 'absolute';\n    svgBackground.style.top = '0';\n    svgBackground.style.left = '0';\n\n    const shapeBackground = svgBackground.appendChild(\n      document.createElementNS(namespaceURI, 'rect'),\n    );\n    shapeBackground.style.position = 'absolute';\n    shapeBackground.setAttribute('x', '0');\n    shapeBackground.setAttribute('y', '0');\n    shapeBackground.setAttribute('width', '100%');\n    shapeBackground.setAttribute('height', '100%');\n    shapeBackground.setAttribute('fill', backgroundColor);\n\n    // Создаем 2 картинки (обычная и с наложенным фильтром) для анимации фильтра\n    // через opacity делаем отображение изображения\n    ['filter', 'real'].forEach(el => {\n      const svg = container.appendChild(document.createElementNS(namespaceURI, 'svg'));\n      svg.classList.add(`svg-${el}`);\n      svg.setAttribute('width', '100%');\n      svg.setAttribute('height', '100%');\n      svg.style.position = 'absolute';\n      svg.style.top = '0';\n      svg.style.left = '0';\n      svg.style.padding = 'inherit';\n\n      const image = svg.appendChild(document.createElementNS(namespaceURI, 'image'));\n      src && image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', src);\n      image.setAttribute('width', '100%');\n      image.setAttribute('height', '100%');\n    });\n\n    return container;\n  };\n\n  const checkFilterExists = ({ filterId, filterValue }) => {\n    if (!document.getElementById(filterId)) {\n      createSVGFilterGrayScale({ filterId, filterValue });\n    }\n  };\n\n  const replaceElem = el => {\n    const id = el.getAttribute('id');\n    const classList = el.classList;\n    const cssText = el.style.cssText;\n    const src = el.getAttribute('src');\n    const backgroundColor = getComputedStyle(el).backgroundColor;\n\n    const filterValue = (el.dataset.filter.match(/grayscale\\(\\s*(\\d+)%\\s*\\)/) || [])[1] || 0;\n    const filterId = `filter-grayscale-${filterValue}`;\n\n    checkFilterExists({ filterId, filterValue });\n\n    const container = createSVGElem({ id, cssText, classList, src, backgroundColor });\n    el.parentNode.insertBefore(container, el);\n    el.remove();\n  };\n\n  const applyFilter = () => {\n    const elements = document.querySelectorAll(`img[data-filter*='grayscale']`);\n    if (elements) {\n      elements.forEach(replaceElem);\n    }\n  };\n\n  if (isSupport) window.addEventListener('load', applyFilter);\n})();\n"],"file":"grayscale-polyfill.js"}