{"version":3,"sources":["grayscale-polyfill.js"],"names":["window","NodeList","prototype","forEach","Array","Element","remove","parentNode","removeChild","Object","getOwnPropertyDescriptor","HTMLElement","classList","defineProperty","checkPropertyFilter","testImg","Image","style","filter","createSVGFilterGrayScale","filterId","filterValue","namespaceURI","svg","document","createElementNS","position","top","left","height","width","defs","appendChild","setAttribute","feColorMatrix","body","createSVGElem","id","cssText","src","backgroundColor","container","createElement","add","svgBackground","shapeBackground","el","padding","zIndex","image","setAttributeNS","checkFilterExists","getElementById","replaceElem","getAttribute","getComputedStyle","dataset","match","insertBefore","applyFilter","elements","querySelectorAll","addEventListener"],"mappings":"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","file":"grayscale-polyfill.js","sourcesContent":["// Запускается в браузерах который не поддерживают свойство filter.\n// Полифил применяетс к тегам img[data-filter='grayscale(50%)']\n// по значению grayscale(50%) создается фильтр #filter-grayscale-50, который\n// нужно использовать с CSS `filter: url('#filter-grayscale-50')`\n// Можно создать несколько фильтров задав разное значение в элементах.\n\n// Удаляет элемент и создает обертку c контейнера (div) и 3-ех SVG:\n// 1) фон с приминением фильтра - необходимо создавать, что бы его расстянуть\n// на весь родительский блок, если в нем заданы отступы padding для изображения\n// 2) изображения для фильтра\n// 3) изображение без фильтра - нужно что бы создать анимацию для фильтра. В IE 11 не\n// filter: url() не работает анимация, поэтому используем прозрачность (opacity)\n//\n// В IE 11 и EDGE - CSS нужно прописывать стили, не на сам SVG, а на его элементы\n//\n//    .svg-filter-background *,\n//    .svg-filter * {\n//       filter: url('#filter-grayscale-100');\n//    }\n//\n//\n//\n\n// Нужно перекомилировать через Babel\n// Неообходимые полифилы для IE-11\n// Element.classList\n// NodeList.forEach\n// Element.remove\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n  NodeList.prototype.forEach = Array.prototype.forEach;\n}\n\nif (!('remove' in Element.prototype)) {\n  Element.prototype.remove = function () {\n    if (this.parentNode) this.parentNode.removeChild(this);\n  };\n}\n\nif (!Object.getOwnPropertyDescriptor(Element.prototype,'classList') && HTMLElement) {\n  const classList = Object.getOwnPropertyDescriptor(HTMLElement.prototype,'classList');\n  classList && Object.defineProperty(Element.prototype,'classList', classList);\n}\n\n(() => {\n  // В IE 11 fiter значение не применяется, но само свойство присуствует\n  const checkPropertyFilter = (() => {\n    const testImg = new Image()\n    testImg.style.filter = 'grayscale(100%)';\n    return !testImg.style.filter\n  })();\n\n  // Создаем фильтр\n  const createSVGFilterGrayScale = ({filterId, filterValue}) => {\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(namespaceURI, 'svg');\n\n    svg.style.position = 'absolute';\n    svg.style.top = '0';\n    svg.style.left = '0';\n    svg.style.height = '0';\n    svg.style.width = '0';\n\n    const defs = svg.appendChild(document.createElementNS(namespaceURI, 'defs'));\n\n    const filter = defs.appendChild(document.createElementNS(namespaceURI, 'filter'));\n    filter.setAttribute('id', filterId);\n    const feColorMatrix = filter.appendChild(document.createElementNS(namespaceURI, 'feColorMatrix'));\n    feColorMatrix.setAttribute('id', 'filter-grayscale-elem');\n    feColorMatrix.setAttribute('type', 'saturate');\n    feColorMatrix.setAttribute('values', `${1 - filterValue / 100}`);\n\n    document.body.appendChild(svg);\n  }\n\n  const createSVGElem = ({id, cssText, classList, src, backgroundColor}) => {\n    const container = document.createElement('div');\n    id && container.setAttribute('id', id);\n    classList && container.classList.add(classList);\n    cssText && (container.style.cssText = cssText);\n    container.style.position === 'absolute' && (container.style.position = 'relative');\n\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n\n\n    // Создаем SVG для фона c наложеным фильтром\n    // потому что у IE11 и EDGE не\n    // работает filter если его применить в SVG\n    const svgBackground = container.appendChild(document.createElementNS(namespaceURI, 'svg'));\n    svgBackground.classList.add('svg-filter-background');\n    svgBackground.setAttribute('width', '100%');\n    svgBackground.setAttribute('height', '100%');\n    svgBackground.style.position = 'absolute';\n    svgBackground.style.top = '0';\n    svgBackground.style.left = '0';\n\n    const shapeBackground = svgBackground.appendChild(document.createElementNS(namespaceURI, 'rect'));\n    shapeBackground.style.position = 'absolute';\n    shapeBackground.setAttribute('x', '0');\n    shapeBackground.setAttribute('y', '0');\n    shapeBackground.setAttribute('width', '100%');\n    shapeBackground.setAttribute('height', '100%');\n    shapeBackground.setAttribute('fill', backgroundColor);\n\n    // Создаем 2 картинки (обычная и с наложенным фильтром) для анимации фильтра\n    // через opacity делаем отображение изображения\n    ['filter','real'].forEach( el => {\n      const svg = container.appendChild(document.createElementNS(namespaceURI, 'svg'));\n      svg.classList.add(`svg-${el}`);\n      svg.setAttribute('width', '100%');\n      svg.setAttribute('height', '100%');\n      svg.style.position = 'absolute';\n      svg.style.top = '0';\n      svg.style.left = '0';\n      svg.style.padding = 'inherit';\n      svg.style.zIndex = '9999';\n\n      const image = svg.appendChild(document.createElementNS(namespaceURI, 'image'));\n      src && image.setAttributeNS('http://www.w3.org/1999/xlink','href', src);\n      image.setAttribute('width', '100%');\n      image.setAttribute('height', '100%');\n    })\n\n    return container;\n  }\n\n  const checkFilterExists = ({filterId, filterValue}) => {\n    if (!document.getElementById(filterId)) {\n      createSVGFilterGrayScale({filterId, filterValue});\n    }\n  }\n\n  const replaceElem = el => {\n    const id = el.getAttribute('id');\n    const classList = el.classList;\n    const cssText = el.style.cssText;\n    const src = el.getAttribute('src');\n    const backgroundColor = getComputedStyle(el).backgroundColor;\n\n    const filterValue = (el.dataset.filter.match(/grayscale\\(\\s*(\\d+)%\\s*\\)/) || [])[1] || 0;\n    const filterId = `filter-grayscale-${filterValue}`;\n\n    checkFilterExists({filterId, filterValue});\n\n    const container = createSVGElem({id, cssText, classList, src, backgroundColor});\n    el.parentNode.insertBefore(container, el);\n    el.remove();\n  }\n\n  const applyFilter = () => {\n    const elements = document.querySelectorAll(`img[data-filter*='grayscale']`);\n    if (elements) {\n      elements.forEach(replaceElem);\n    }\n  }\n\n  if (checkPropertyFilter) {\n    window.addEventListener('load', applyFilter);\n  }\n})();\n"]}