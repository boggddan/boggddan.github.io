{"version":3,"sources":["multiply-background-blend-mode-polyfill.js"],"names":["Element","prototype","Document","DocumentFragment","forEach","item","prepend","docFrag","document","createDocumentFragment","Array","slice","call","arguments","argItem","appendChild","Node","createTextNode","String","insertBefore","firstChild","window","NodeList","isNotSupport","getComputedStyle","body","backgroundBlendMode","undefined","createSVGFilter","backgroundImage","backgroundColor","uniqueId","Date","getUTCMilliseconds","filterId","namespaceURI","svg","createElementNS","setAttribute","style","position","overflow","defs","filter","feImage","setAttributeNS","feBlend","shapeBackground","applyFilter","elements","querySelectorAll","el","borderTopWidth","borderWidth","backgroundImageUrl","replace","dataset","borderTopColor","borderTopStyle","addEventListener"],"mappings":"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","file":"multiply-background-blend-mode-polyfill.js","sourcesContent":["// Запускается в браузерах который не поддерживают свойство background-blend-mode.\n// Полифил применяетс к тегам [data-background-bland-mode=\"multiply\"]\n// Изображение и цвет берет с CSS свойств (background-image, background-color)\n// IE 11 работает огранниченное количество фильтров: normal, myltiply, lighten, screen, darken\n//   https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/samples/jj206437(v=vs.85)\n\n// Нужно перекомилировать через Babel\n// Неообходимые полифилы для IE-11\n// Element.prepend\n// NodeList.forEach\n\n// prepend polyfill\n[Element.prototype, Document.prototype, DocumentFragment.prototype].forEach(function (item) {\n  item.prepend = item.prepend || function () {\n    var docFrag = document.createDocumentFragment();\n\n    Array.prototype.slice.call(arguments).forEach(function (argItem) {\n      docFrag.appendChild(argItem instanceof Node ? argItem : document.createTextNode(String(argItem)));\n    });\n\n    this.insertBefore(docFrag, this.firstChild);\n  };\n});\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n  NodeList.prototype.forEach = Array.prototype.forEach;\n}\n\n(() => {\n  const isNotSupport = getComputedStyle(document.body).backgroundBlendMode === undefined;\n\n  // Создаем фильтр\n  const createSVGFilter = ({ backgroundImage, backgroundColor, backgroundBlendMode }) => {\n    const uniqueId = new Date().getUTCMilliseconds();\n    const filterId = `background-filter-${uniqueId}`;\n\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(namespaceURI, 'svg');\n    svg.setAttribute('height', '100%');\n    svg.setAttribute('width', '100%');\n    svg.style.position = 'absolute';\n    svg.style.overflow = 'hidden';\n\n    const defs = svg.appendChild(document.createElementNS(namespaceURI, 'defs'));\n    const filter = defs.appendChild(document.createElementNS(namespaceURI, 'filter'));\n    filter.setAttribute('id', filterId);\n\n    const feImage = filter.appendChild(document.createElementNS(namespaceURI, 'feImage'));\n    feImage.setAttribute('preserveAspectRatio', 'xMinYMin slice');\n    feImage.setAttribute('x', '0');\n    feImage.setAttribute('y', '0');\n    feImage.setAttribute('height', '100%');\n    feImage.setAttribute('width', '100%');\n    feImage.setAttribute('result', 'slide2');\n    feImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', backgroundImage);\n\n    const feBlend = filter.appendChild(document.createElementNS(namespaceURI, 'feBlend'));\n    feBlend.setAttribute('preserveAspectRatio', 'xMinYMin slice');\n    feBlend.setAttribute('in', 'slide2');\n    feBlend.setAttribute('in2', 'SourceGraphic');\n    feBlend.setAttribute('mode', backgroundBlendMode);\n\n    const shapeBackground = svg.appendChild(document.createElementNS(namespaceURI, 'rect'));\n    shapeBackground.style.position = 'absolute';\n    shapeBackground.setAttribute('x', '0');\n    shapeBackground.setAttribute('y', '0');\n    shapeBackground.setAttribute('width', '100%');\n    shapeBackground.setAttribute('height', '100%');\n    shapeBackground.setAttribute('filter', `url(#${filterId})`);\n    shapeBackground.setAttribute('fill', backgroundColor);\n\n    return svg;\n  };\n\n  const applyFilter = () => {\n    const elements = document.querySelectorAll(`[data-background-blend-mode]`);\n\n    if (elements) {\n      elements.forEach(el => {\n        const { borderTopWidth, position, borderWidth, backgroundImage: backgroundImageUrl, backgroundColor } = getComputedStyle(el);\n        const backgroundImage = backgroundImageUrl && backgroundImageUrl.replace(/\"/g,'').slice(4, -1);\n        const backgroundBlendMode = el.dataset.backgroundBlendMode;\n\n        if (backgroundImage && backgroundColor && backgroundBlendMode) {\n          if (position === 'static') el.style.position = 'relative';\n\n          if (borderTopWidth) {\n            el.style.borderTopWidth = '0.01px';\n            el.style.borderTopColor = 'transparent';\n            el.style.borderTopStyle = 'solid';\n          }\n\n          el.prepend(createSVGFilter({ backgroundImage, backgroundColor, backgroundBlendMode }));\n        }\n      });\n    }\n  };\n\n  if (isNotSupport) window.addEventListener('load', applyFilter);\n})();\n"]}