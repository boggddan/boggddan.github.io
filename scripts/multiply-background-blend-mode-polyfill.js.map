{"version":3,"sources":["multiply-background-blend-mode-polyfill.js"],"names":["Element","prototype","Document","DocumentFragment","forEach","item","prepend","docFrag","document","createDocumentFragment","Array","slice","call","arguments","argItem","appendChild","Node","createTextNode","String","insertBefore","firstChild","window","NodeList","isNotSupport","getComputedStyle","body","backgroundBlendMode","undefined","createSVGFilter","backgroundImage","backgroundColor","uniqueId","Date","getUTCMilliseconds","filterId","namespaceURI","svg","createElementNS","setAttribute","style","position","top","left","bottom","right","overflow","defs","filter","feImage","setAttributeNS","feBlend","shapeBackground","onResize","el","running","windowHeight","update","innerHeight","height","documentElement","scrollHeight","requestTick","requestAnimationFrame","addEventListener","applyFilter","elements","querySelectorAll","borderTopWidth","borderWidth","backgroundImageUrl","replace","dataset","borderTopColor","borderTopStyle","tagName","toLowerCase"],"mappings":"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","sourcesContent":["// Запускается в браузерах который не поддерживают свойство background-blend-mode.\n// Полифил применяетс к тегам [data-background-blend-mode=\"multiply\"]\n// Изображение и цвет берет с CSS свойств (background-image, background-color)\n// IE 11 работает огранниченное количество фильтров: normal, myltiply, lighten, screen, darken\n//   https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/mode\n//   https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/samples/jj206437(v=vs.85)\n\n// Нужно перекомилировать через Babel\n// Неообходимые полифилы для IE-11\n// Element.prepend\n// NodeList.forEach\n\n// prepend polyfill\n[Element.prototype, Document.prototype, DocumentFragment.prototype].forEach(function (item) {\n  item.prepend = item.prepend || function () {\n    var docFrag = document.createDocumentFragment();\n\n    Array.prototype.slice.call(arguments).forEach(function (argItem) {\n      docFrag.appendChild(argItem instanceof Node ? argItem : document.createTextNode(String(argItem)));\n    });\n\n    this.insertBefore(docFrag, this.firstChild);\n  };\n});\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n  NodeList.prototype.forEach = Array.prototype.forEach;\n}\n\n(() => {\n  const isNotSupport = getComputedStyle(document.body).backgroundBlendMode === undefined;\n\n  // Создаем фильтр\n  const createSVGFilter = ({ backgroundImage, backgroundColor, backgroundBlendMode }) => {\n    const uniqueId = new Date().getUTCMilliseconds();\n    const filterId = `background-filter-${uniqueId}`;\n\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(namespaceURI, 'svg');\n    svg.setAttribute('height', '100%');\n    svg.setAttribute('width', '100%');\n    svg.style.position = 'absolute';\n    svg.style.top = '0';\n    svg.style.left = '0';\n    svg.style.bottom = '0';\n    svg.style.right = '0';\n    svg.style.overflow = 'hidden';\n\n    const defs = svg.appendChild(document.createElementNS(namespaceURI, 'defs'));\n    const filter = defs.appendChild(document.createElementNS(namespaceURI, 'filter'));\n    filter.setAttribute('id', filterId);\n\n    const feImage = filter.appendChild(document.createElementNS(namespaceURI, 'feImage'));\n    feImage.setAttribute('preserveAspectRatio', 'xMinYMin slice');\n    feImage.setAttribute('x', '0');\n    feImage.setAttribute('y', '0');\n    feImage.setAttribute('height', '100%');\n    feImage.setAttribute('width', '100%');\n    feImage.setAttribute('result', 'slide2');\n    feImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', backgroundImage);\n\n    const feBlend = filter.appendChild(document.createElementNS(namespaceURI, 'feBlend'));\n    feBlend.setAttribute('preserveAspectRatio', 'xMinYMin slice');\n    feBlend.setAttribute('in', 'slide2');\n    feBlend.setAttribute('in2', 'SourceGraphic');\n    feBlend.setAttribute('mode', backgroundBlendMode);\n\n    const shapeBackground = svg.appendChild(document.createElementNS(namespaceURI, 'rect'));\n    shapeBackground.style.position = 'absolute';\n    shapeBackground.setAttribute('x', '0');\n    shapeBackground.setAttribute('y', '0');\n    shapeBackground.setAttribute('width', '100%');\n    shapeBackground.setAttribute('height', '100%');\n    shapeBackground.setAttribute('filter', `url(#${filterId})`);\n    shapeBackground.setAttribute('fill', backgroundColor);\n\n    return svg;\n  };\n\n  const onResize = el => {\n    let running = false;\n    let windowHeight = 0;\n\n    const update = () => {\n      if (windowHeight !== window.innerHeight) {\n        windowHeight = window.innerHeight;\n        el.style.height = 'auto';\n        el.style.height = `${document.documentElement.scrollHeight}px`;\n      }\n      running = false;\n    }\n\n    const requestTick = () => {\n      if(!running) requestAnimationFrame(update);\n      running = true;\n    }\n\n    requestTick();\n    window.addEventListener('resize', requestTick);\n  }\n\n  const applyFilter = () => {\n    const elements = document.querySelectorAll(`[data-background-blend-mode]`);\n\n    if (elements) {\n      elements.forEach(el => {\n        const { borderTopWidth, position, borderWidth, backgroundImage: backgroundImageUrl, backgroundColor } = getComputedStyle(el);\n        const backgroundImage = backgroundImageUrl && backgroundImageUrl.replace(/\"/g,'').slice(4, -1);\n        const backgroundBlendMode = el.dataset.backgroundBlendMode;\n\n        if (backgroundImage && backgroundColor && backgroundBlendMode) {\n          if (position === 'static') el.style.position = 'relative';\n\n          if (borderTopWidth) {\n            el.style.borderTopWidth = '0.01px';\n            el.style.borderTopColor = 'transparent';\n            el.style.borderTopStyle = 'solid';\n          }\n          const svg = createSVGFilter({ backgroundImage, backgroundColor, backgroundBlendMode });\n          el.prepend(svg);\n\n          // Если фон для Body, нужно по вешать обработчик события на измнения размеров окна\n          // потому что размер body может быть меньша размера документа, когда часть контента\n          // выпадает\n          if (el.tagName.toLowerCase() === 'body') onResize(svg)\n        }\n      });\n    }\n  };\n\n  if (isNotSupport) window.addEventListener('load', applyFilter);\n})();\n"],"file":"multiply-background-blend-mode-polyfill.js"}